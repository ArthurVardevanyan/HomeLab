apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
resources:
  - ../../base
components:
  - ../../components/rootless
patches:
  - target:
      kind: Deployment
      name: ntp-rootless
    patch: |-
      - op: replace
        path: /spec/replicas
        value: 1
      - op: replace
        path:  /spec/template/spec/containers/0/image
        value: registry.arthurvardevanyan.com/homelab/ntp:rootless-arm@sha256:50b77c7a71371f68ec5b16cbc611d5b363aff5d30a3b57eea39c10069e098d37
      - op: add
        path:  /spec/template/metadata/annotations
        value: {"k8s.v1.cni.cncf.io/networks":"[{\n  \"name\": \"br1-vlan3\",\n  \"namespace\": \"default\",\n  \"mac\": \"10:01:01:00:30:03\",\n  \"ips\": [\"10.101.3.3/24\"]\n}]\n"}
  - target:
      kind: Service
      name: ntp-rootless
    patch: |-
      - op: replace
        path: /metadata/annotations/kube-vip.io~1loadbalancerIPs
        value: "10.0.0.97"
  - target:
      kind: Namespace
      name: ntp
    patch: |-
      - op: replace
        path: /metadata/labels/pod-security.kubernetes.io~1enforce
        value: restricted
      - op: replace
        path: /metadata/labels/pod-security.kubernetes.io~1warn
        value: restricted
      - op: replace
        path: /metadata/labels/pod-security.kubernetes.io~1audit
        value: restricted
