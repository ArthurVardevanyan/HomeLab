---
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
resources:
  - ../../base
  - ./service.yaml
components:
  - ../../components/rootless
    # renovate: datasource=docker depName=registry.arthurvardevanyan.com/homelab/ntp versioning=loose
patches:
  - patch: |-
      - op: replace
        path: /spec/replicas
        value: 1
      - op: replace
        path:  /spec/template/spec/containers/0/image
        # renovate: datasource=docker depName=registry.arthurvardevanyan.com/homelab/ntp versioning=loose
        value: registry.arthurvardevanyan.com/homelab/ntp:2025.12.23.032052-rootless@sha256:062c78df420246832b034dfa3ad178a818db599af07186c28e59e9bc4ff2730f
      - op: remove
        path:  /spec/template/metadata/annotations/k8s.v1.cni.cncf.io~1networks
      - op: remove
        path:  /spec/template/spec/securityContext/sysctls
      - op: remove
        path:  /spec/template/spec/containers/0/securityContext/capabilities/add
      - op: replace
        path:  /spec/template/spec/containers/0/ports/0/containerPort
        value: 12345
      - op: replace
        path:  /spec/template/spec/containers/0/env/1/value
        value: "12345"
    target:
      kind: Deployment
      name: ntp-rootless
  - patch: |-
      - op: replace
        path: /metadata/annotations/kube-vip.io~1loadbalancerIPs
        value: "10.101.1.2"
    target:
      kind: Service
      name: ntp-rootless
  - patch: |-
      - op: replace
        path: /metadata/annotations/kube-vip.io~1loadbalancerIPs
        value: "10.102.3.2"
    target:
      kind: Service
      name: ntp-rootless-vlan3
