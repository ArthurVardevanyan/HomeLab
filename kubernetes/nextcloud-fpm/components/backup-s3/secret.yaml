apiVersion: v1
kind: Secret
metadata:
  name: s3-config
  namespace: nextcloud-fpm
  labels:
    name: s3
stringData:
  rclone.conf: |
    [unas]
    type = s3
    provider = Other
    env_auth = false
    access_key_id = <path:secret/data/homelab/minio#access_key>
    secret_access_key = <path:secret/data/homelab/minio#access_key>
    endpoint = https://s3.unas.arthurvardevanyan.com
    region = us-east-1
    acl = private

    [ceph]
    type = s3
    provider = Other
    env_auth = false
    access_key_id = <path:secret/data/homelab/nextcloud/ceph#access_key>
    secret_access_key = <path:secret/data/homelab/nextcloud/ceph#secret_key>
    endpoint = http://rook-ceph-rgw-rook-ceph-obj.rook-ceph.svc.cluster.local:8080
    region = us-east-1
    acl = private
  s3.sh: |-
    #!/bin/sh

    mkdir -p /tmp/.config/rclone
    cp /mnt/s3/rclone.conf /tmp/.config/rclone/rclone.conf
    rclone --progress sync ceph:nextcloud-8bc4b121-9fea-4f92-ac9c-2a1cce320084 unas:nextcloud --ignore-existing \
    --stats=10s --stats-log-level NOTICE --fast-list \
    --multi-thread-streams 8 --drive-chunk-size 128M --max-backlog 999999 \
    --transfers=25 --checkers=25 --buffer-size=75M
type: Opaque
