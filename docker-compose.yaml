version: "3.7"

services:
  heimdall:
    image: linuxserver/heimdall
    container_name: heimdall
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=America/Detroit
    volumes:
      - /home/arthur/docker/heimdall:/config
    ports:
      - 80:80
      - 443:443
    restart: unless-stopped
  pihole:
    container_name: pihole
    image: pihole/pihole
    hostname: pihole
    networks:
      dockerBridge:
        ipv4_address: 10.0.0.4
    ports:
      - "53:53/tcp"
      - "53:53/udp"
      - "67:67/udp"
      - "80:80/tcp"
    deploy:
      resources:
        limits:
          cpus: "0.5"
    environment:
      TZ: "America/Chicago"
    volumes:
      - "/home/arthur/docker/pihole/etc-pihole/:/etc/pihole/"
      - "/home/arthur/docker/pihole/etc-dnsmasq.d/:/etc/dnsmasq.d/"
    cap_add:
      - NET_ADMIN
    restart: always
  mariadb:
    container_name: mariadb
    image: mariadb
    restart: always
    networks:
      dockerBridge:
        ipv4_address: 10.0.0.5
    ports:
      - "80:80"
      - "3306:3306"
    volumes:
      - "/home/arthur/docker/mariadb/data:/var/lib/mysql"
      - "/home/arthur/docker/mariadb/mysql:/etc/mysql"
  nextcloud:
    container_name: nextcloud
    hostname: nextcloud
    image: nextcloud
    restart: always
    ports:
      - 7070:7070
    volumes:
      - "/home/arthur/docker/nextcloud/nextcloud:/var/www/html"
      - "/home/arthur/docker/nextcloud/apps:/var/www/html/custom_apps"
      - "/home/arthur/docker/nextcloud/config:/var/www/html/config"
      - "/backup/File_Storage/Nextcloud:/var/www/html/data"
      - "/home/arthur/docker/nextcloud/apache2:/etc/apache2"
      - "/home/arthur/docker/nextcloud/letsencrypt/:/etc/letsencrypt"
    depends_on:
      - mariadb
  phpmyadmin:
    container_name: phpmyadmin
    image: phpmyadmin
    restart: always
    network_mode: "service:mariadb"
    depends_on:
      - mariadb
    environment:
      - PMA_HOST=10.0.0.5
      - UPLOAD_LIMIT=500M
    deploy:
      resources:
        limits:
          cpus: "0.5"
  homeassistant:
    container_name: homeassistant
    hostname: homeassistant
    image: homeassistant/home-assistant
    restart: always
    ports:
      - 8123:8123
    networks:
      dockerBridge:
        ipv4_address: 10.0.0.3
    volumes:
      - "/etc/localtime:/etc/localtime:ro"
      - "/home/arthur/docker/homeassistant/:/config"
    deploy:
      resources:
        limits:
          cpus: "0.75"
    depends_on:
      - mariadb
  analytics-for-spotify:
    container_name: analytics-for-spotify
    hostname: analytics-for-spotify
    #env_file: .env
    image: ${REPOSITORY}
    environment:
      - DOCKER=YES
      - CLIENT_ID=${CLIENT_ID}
      - CLIENT_SECRET=${CLIENT_SECRET}
      - REDIRECT_URL=${REDIRECT_URL}
      - HOST=${HOST}
      - DATABASE=${DATABASE}
      - USER=${USERNAME}
      - PASSWORD=${PASSWORD}
    restart: always
    networks:
      dockerBridge:
        ipv4_address: 10.0.0.6
    ports:
      - "80:80"
    deploy:
      resources:
        limits:
          cpus: "0.75"
    depends_on:
      - mariadb
  test-analytics-for-spotify:
    container_name: test-analytics-for-spotify
    image: ${TEST_REPOSITORY}
    environment:
      - DOCKER=YES
      - CLIENT_ID=${TEST_CLIENT_ID}
      - CLIENT_SECRET=${TEST_CLIENT_SECRET}
      - REDIRECT_URL=${TEST_REDIRECT_URL_HTTPS}
      - HOST=${TEST_HOST}
      - DATABASE=${TEST_DATABASE}
      - USER=${TEST_USERNAME}
      - PASSWORD=${TEST_PASSWORD}
    restart: unless-stopped
    volumes:
      - "/home/arthur/docker/analytics-for-spotify/:/home/root/cert"
    ports:
      - "8080:80"
    deploy:
      resources:
        limits:
          cpus: "0.75"
    depends_on:
      - mariadb
      - analytics-for-spotify
networks:
  dockerBridge:
    external: true
