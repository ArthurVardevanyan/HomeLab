global
    log         127.0.0.1 local2 info
    chroot      /var/lib/haproxy
    pidfile     /var/run/haproxy.pid
    maxconn     4000
    user        haproxy
    group       haproxy
    daemon

defaults
    timeout connect         5s
    timeout client          30s
    timeout server          30s
    log                     global

frontend k3s-api
    bind 0.0.0.0:6443
    default_backend k3s-api
    mode tcp
    option tcplog

backend k3s-api
    balance source
    mode tcp
    server master-0 10.10.10.3:6443 check
    server master-1 10.10.10.4:6443 check
    server master-2 10.10.10.5:6443 check


frontend k3s-https
    bind 0.0.0.0:443
    default_backend k3s-https
    mode tcp
    option tcplog

backend k3s-https
    balance source
    mode tcp
    server worker-0 10.10.10.6:443 check
    server worker-1 10.10.10.7:443 check
    server worker-2 10.10.10.8:443 check
    server worker-3 10.10.10.9:443 check

frontend k3s-http
    bind 0.0.0.0:80
    default_backend k3s-http
    mode tcp
    option tcplog

backend k3s-http
    balance source
    mode tcp
    server worker-0 10.10.10.6:80 check
    server worker-1 10.10.10.7:80 check
    server worker-2 10.10.10.8:80 check
    server worker-3 10.10.10.9:80 check

