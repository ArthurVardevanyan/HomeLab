before_script:
  - mkdir -p ~/.ssh
  - chmod 700 ~/.ssh
  - echo "$SSH_KNOWN_HOSTS" >> ~/.ssh/known_hosts
  - chmod 644 ~/.ssh/known_hosts

StandardPackages:
  stage: ansible
  image: $CI_REGISTRY_IMAGE:ansible
  variables:
    PLAYBOOK: serverPackages
  before_script:
    - ansible-playbook -i ansible/inventory ansible/playbooks/server/${PLAYBOOK}.yaml --extra-vars "ansible_become_pass=${SUDO} ansible_ssh_pass=${SUDO}" --check
  script:
    - ansible-playbook -i ansible/inventory ansible/playbooks/server/${PLAYBOOK}.yaml --extra-vars "ansible_become_pass=${SUDO} ansible_ssh_pass=${SUDO}"

ZSH:
  stage: ansible
  image: $CI_REGISTRY_IMAGE:ansible
  variables:
    PLAYBOOK: zsh
  before_script:
    - ansible-playbook -i ansible/inventory ansible/playbooks/server/${PLAYBOOK}.yaml --extra-vars "ansible_become_pass=${SUDO} ansible_ssh_pass=${SUDO}" --check
  script:
    - ansible-playbook -i ansible/inventory ansible/playbooks/server/${PLAYBOOK}.yaml --extra-vars "ansible_become_pass=${SUDO} ansible_ssh_pass=${SUDO}"

Cockpit:
  stage: ansible
  image: $CI_REGISTRY_IMAGE:ansible
  variables:
    PLAYBOOK: cockpit
  before_script:
    - ansible-playbook -i ansible/inventory ansible/playbooks/server/${PLAYBOOK}.yaml --extra-vars "ansible_become_pass=${SUDO} ansible_ssh_pass=${SUDO}" --check
  script:
    - ansible-playbook -i ansible/inventory ansible/playbooks/server/${PLAYBOOK}.yaml --extra-vars "ansible_become_pass=${SUDO} ansible_ssh_pass=${SUDO}"

IPV6:
  stage: ansible
  image: $CI_REGISTRY_IMAGE:ansible
  variables:
    PLAYBOOK: ipv6
  before_script:
    - ansible-playbook -i ansible/inventory ansible/playbooks/server/${PLAYBOOK}.yaml --extra-vars "ansible_become_pass=${SUDO} ansible_ssh_pass=${SUDO}" --check
  script:
    - ansible-playbook -i ansible/inventory ansible/playbooks/server/${PLAYBOOK}.yaml --extra-vars "ansible_become_pass=${SUDO} ansible_ssh_pass=${SUDO}"

ZFS:
  stage: ansible
  image: $CI_REGISTRY_IMAGE:ansible
  variables:
    PLAYBOOK: zfs
  before_script:
    - ansible-playbook -i ansible/inventory ansible/playbooks/server/${PLAYBOOK}.yaml --extra-vars "ansible_become_pass=${SUDO} ansible_ssh_pass=${SUDO}" --check
  script:
    - ansible-playbook -i ansible/inventory ansible/playbooks/server/${PLAYBOOK}.yaml --extra-vars "ansible_become_pass=${SUDO} ansible_ssh_pass=${SUDO}"

Samba:
  stage: ansible
  image: $CI_REGISTRY_IMAGE:ansible
  variables:
    PLAYBOOK: samba
  before_script:
    - ansible-playbook -i ansible/inventory ansible/playbooks/server/${PLAYBOOK}.yaml --extra-vars "ansible_become_pass=${SUDO} ansible_ssh_pass=${SUDO}" --check
  script:
    - ansible-playbook -i ansible/inventory ansible/playbooks/server/${PLAYBOOK}.yaml --extra-vars "ansible_become_pass=${SUDO} ansible_ssh_pass=${SUDO}"

Timeshift:
  stage: ansible
  image: $CI_REGISTRY_IMAGE:ansible
  variables:
    PLAYBOOK: timeshift
  before_script:
    - ansible-playbook -i ansible/inventory ansible/playbooks/server/${PLAYBOOK}.yaml --extra-vars "ansible_become_pass=${SUDO} ansible_ssh_pass=${SUDO}" --check
  script:
    - ansible-playbook -i ansible/inventory ansible/playbooks/server/${PLAYBOOK}.yaml --extra-vars "ansible_become_pass=${SUDO} ansible_ssh_pass=${SUDO}"

Logrotate:
  stage: ansible
  image: $CI_REGISTRY_IMAGE:ansible
  variables:
    PLAYBOOK: logrotate
  before_script:
    - ansible-playbook -i ansible/inventory ansible/playbooks/server/${PLAYBOOK}.yaml --extra-vars "ansible_become_pass=${SUDO} ansible_ssh_pass=${SUDO}" --check
  script:
    - ansible-playbook -i ansible/inventory ansible/playbooks/server/${PLAYBOOK}.yaml --extra-vars "ansible_become_pass=${SUDO} ansible_ssh_pass=${SUDO}"

SSHD:
  stage: ansible
  image: $CI_REGISTRY_IMAGE:ansible
  variables:
    PLAYBOOK: sshd
  before_script:
    - ansible-playbook -i ansible/inventory ansible/playbooks/server/${PLAYBOOK}.yaml --extra-vars "ansible_become_pass=${SUDO} ansible_ssh_pass=${SUDO}" --check
  script:
    - ansible-playbook -i ansible/inventory ansible/playbooks/server/${PLAYBOOK}.yaml --extra-vars "ansible_become_pass=${SUDO} ansible_ssh_pass=${SUDO}"

Network:
  stage: ansible
  image: $CI_REGISTRY_IMAGE:ansible
  variables:
    PLAYBOOK: network
  before_script:
    - ansible-playbook -i ansible/inventory ansible/playbooks/server/${PLAYBOOK}.yaml --extra-vars "ansible_become_pass=${SUDO} ansible_ssh_pass=${SUDO}" --check
  script:
    - ansible-playbook -i ansible/inventory ansible/playbooks/server/${PLAYBOOK}.yaml --extra-vars "ansible_become_pass=${SUDO} ansible_ssh_pass=${SUDO}"

TimeshiftMount:
  stage: ansible
  image: $CI_REGISTRY_IMAGE:ansible
  variables:
    PLAYBOOK: timeshiftMount
  before_script:
    - ansible-playbook -i ansible/inventory ansible/playbooks/server/${PLAYBOOK}.yaml --extra-vars "ansible_become_pass=${SUDO} ansible_ssh_pass=${SUDO}" --check
  script:
    - ansible-playbook -i ansible/inventory ansible/playbooks/server/${PLAYBOOK}.yaml --extra-vars "ansible_become_pass=${SUDO} ansible_ssh_pass=${SUDO}"

Cron:
  stage: ansible
  image: $CI_REGISTRY_IMAGE:ansible
  variables:
    PLAYBOOK: cron
  before_script:
    - ansible-playbook -i ansible/inventory ansible/playbooks/server/${PLAYBOOK}.yaml --extra-vars "ansible_become_pass=${SUDO} ansible_ssh_pass=${SUDO}" --check
  script:
    - ansible-playbook -i ansible/inventory ansible/playbooks/server/${PLAYBOOK}.yaml --extra-vars "ansible_become_pass=${SUDO} ansible_ssh_pass=${SUDO}"

LuckyBackup:
  stage: ansible
  image: $CI_REGISTRY_IMAGE:ansible
  variables:
    PLAYBOOK: luckyBackup
  before_script:
    - ansible-playbook -i ansible/inventory ansible/playbooks/server/${PLAYBOOK}.yaml --extra-vars "ansible_become_pass=${SUDO} ansible_ssh_pass=${SUDO}" --check
  script:
    - ansible-playbook -i ansible/inventory ansible/playbooks/server/${PLAYBOOK}.yaml --extra-vars "ansible_become_pass=${SUDO} ansible_ssh_pass=${SUDO}"

EZweb:
  stage: ansible
  image: $CI_REGISTRY_IMAGE:ansible
  variables:
    PLAYBOOK: ezweb
  before_script:
    - ansible-playbook -i ansible/inventory ansible/playbooks/server/${PLAYBOOK}.yaml --extra-vars "ansible_become_pass=${SUDO} ansible_ssh_pass=${SUDO}" --check
  script:
    - ansible-playbook -i ansible/inventory ansible/playbooks/server/${PLAYBOOK}.yaml --extra-vars "ansible_become_pass=${SUDO} ansible_ssh_pass=${SUDO}"

K3s:
  stage: ansible
  image: $CI_REGISTRY_IMAGE:ansible
  variables:
    PLAYBOOK: kubernetes
  before_script:
    - ansible-playbook -i ansible/inventory ansible/playbooks/server/${PLAYBOOK}.yaml --extra-vars "ansible_become_pass=${SUDO} ansible_ssh_pass=${SUDO}" --check
  script:
    - ansible-playbook -i ansible/inventory ansible/playbooks/server/${PLAYBOOK}.yaml --extra-vars "ansible_become_pass=${SUDO} ansible_ssh_pass=${SUDO}"

Discord:
  stage: ansible
  image: $CI_REGISTRY_IMAGE:ansible
  variables:
    PLAYBOOK: discord_bot
  before_script:
    - sed -i "s,REPLACE_ME,${DISCORD},g" machineConfigs/server/home/arthur/discord/discord_bot.sh
    - ansible-playbook -i ansible/inventory ansible/playbooks/server/${PLAYBOOK}.yaml --extra-vars "ansible_become_pass=${SUDO} ansible_ssh_pass=${SUDO}" --check
  script:
    - ansible-playbook -i ansible/inventory ansible/playbooks/server/${PLAYBOOK}.yaml --extra-vars "ansible_become_pass=${SUDO} ansible_ssh_pass=${SUDO}"
