---
- name: Setup Discord Bot services on K3s nodes
  hosts: k3s
  gather_facts: false
  become: true
  user: arthur
  ignore_unreachable: true
  tasks:
    - name: Create Discord Bot Boot Service
      ansible.builtin.copy:
        src: "../../../../machineConfigs/servers/server/etc/systemd/system/discordBoot.service"
        dest: "/etc/systemd/system/discordBoot.service"
        mode: "0644"
      notify: Enable Discord Boot Service

    - name: Create Discord Bot Reboot Service
      ansible.builtin.copy:
        src: "../../../../machineConfigs/servers/server/etc/systemd/system/discordReboot.service"
        dest: "/etc/systemd/system/discordReboot.service"
        mode: "0644"
      notify: Enable Discord Reboot Service

    - name: Create Discord Bot Shutdown Service
      ansible.builtin.copy:
        src: "../../../../machineConfigs/servers/server/etc/systemd/system/discordShutdown.service"
        dest: "/etc/systemd/system/discordShutdown.service"
        mode: "0644"
      notify: Enable Discord Shutdown Service

    - name: Creates Discord Directory
      ansible.builtin.file:
        path: /home/arthur/discord
        state: directory
        mode: "0755"
        owner: arthur
        group: arthur

    - name: Git Clone discord.sh
      ansible.builtin.git:
        repo: "https://github.com/fieu/discord.sh"
        dest: /home/arthur/discord
        version: master

  handlers:
    - name: Enable Discord Boot Service
      ansible.builtin.systemd:
        name: discordBoot.service
        enabled: true
        daemon_reload: true

    - name: Enable Discord Reboot Service
      ansible.builtin.systemd:
        name: discordReboot.service
        enabled: true
        daemon_reload: true

    - name: Enable Discord Shutdown Service
      ansible.builtin.systemd:
        name: discordShutdown.service
        enabled: true
        daemon_reload: true
        repo: "https://github.com/fieu/discord.sh"
        dest: /home/arthur/discord/discord.sh
        version: master

    - name: Create Discord Bot Script
      ansible.builtin.copy:
        src: "../../../../machineConfigs/servers/server/home/arthur/discord/discord_bot.sh"
        dest: "/home/arthur/discord/discord_bot.sh"
        mode: "0755"
        owner: arthur
        group: arthur
