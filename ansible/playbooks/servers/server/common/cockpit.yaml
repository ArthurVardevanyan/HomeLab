---
- name: Install and configure Cockpit on common servers
  hosts: servers-common
  gather_facts: false
  become: true
  user: arthur
  tasks:
    - name: Install Cockpit
      ansible.builtin.dnf:
        state: present
        name:
          # renovate: datasource=repology depName=centos_stream_9/cockpit
          - cockpit #-344-1.el9
          # renovate: datasource=repology depName=centos_stream_9/pcp
          - pcp #-6.3.7-5.el9

    - name: Cockpit Web Gui Devices
      ansible.builtin.copy:
        src: "../../../../../machineConfigs/servers/server/etc/cockpit/machines.d/99-webui.json"
        dest: "/etc/cockpit/machines.d/99-webui.json"
        mode: "0644"

    - name: Cockpit Cert
      ansible.builtin.copy:
        src: "/tmp/cockpit.crt"
        dest: "/etc/cockpit/ws-certs.d/cockpit.crt"
        mode: "0644"

    - name: Cockpit Key
      ansible.builtin.copy:
        src: "/tmp/cockpit.key"
        dest: "/etc/cockpit/ws-certs.d/cockpit.key"
        mode: "0600"

    - name: Cockpit enable port 9090
      ansible.posix.firewalld:
        zone: public
        port: 9090/tcp
        permanent: true
        state: enabled
    - name: Make sure cockpit service unit is running
      ansible.builtin.systemd_service:
        state: started
        enabled: true
        name: cockpit
