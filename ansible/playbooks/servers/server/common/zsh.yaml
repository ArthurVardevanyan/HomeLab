---
- name: Configure ZSH on common servers
  hosts: servers-common
  gather_facts: false
  user: arthur
  tasks:
    - name: Install packages
      become: true
      ansible.builtin.dnf:
        state: present
        name:
          # renovate: datasource=repology depName=centos_stream_9/zsh
          - zsh #-5.8-9.el9
          # renovate: datasource=repology depName=epel_9/autojump
          - autojump-zsh #-22.5.3-8.el9

    - name: Cloning zsh-autosuggestions
      become: true
      ansible.builtin.git:
        repo: https://github.com/zsh-users/zsh-autosuggestions
        dest: /usr/share/zsh-autosuggestions
        version: master

    - name: Cloning zsh-syntax-highlighting
      become: true
      ansible.builtin.git:
        repo: https://github.com/zsh-users/zsh-syntax-highlighting
        dest: /usr/share/zsh-syntax-highlighting
        version: master

    - name: Cloning oh-my-zsh
      ansible.builtin.git:
        repo: https://github.com/ohmyzsh/ohmyzsh.git
        dest: /home/arthur/.oh-my-zsh
        version: master

    - name: Cloning zsh-kubectl-prompt
      ansible.builtin.git:
        repo: https://github.com/superbrothers/zsh-kubectl-prompt.git
        dest: /home/arthur/.oh-my-zsh/custom/plugins/zsh-kubectl-prompt
        version: master

    - name: Creating new zsh theme
      ansible.builtin.copy:
        src: "../../../../../machineConfigs/desktop/home/arthur/.oh-my-zsh/themes/custom.zsh-theme"
        dest: "/home/arthur/.oh-my-zsh/themes/custom.zsh-theme"
        mode: "0644"

    - name: Creating new ~/.zshrc
      ansible.builtin.copy:
        src: "../../../../../machineConfigs/desktop/home/arthur/.zshrc"
        dest: "/home/arthur/.zshrc"
        mode: "0644"

    - name: Change user shell to zsh
      become: true
      ansible.builtin.user:
        name: "arthur"
        shell: /bin/zsh
