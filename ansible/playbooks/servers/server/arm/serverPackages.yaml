---
- name: Install server packages on ARM servers
  hosts: servers-arm
  gather_facts: false
  become: true
  user: arthur
  tasks:
    - name: Upgrade all packages
      ansible.builtin.dnf:
        name: "*"
        state: latest # noqa package-latest

    - name: Install EPEL
      ansible.builtin.dnf:
        state: present
        name:
          - epel-release

    - name: Install packages
      ansible.builtin.dnf:
        state: present
        name:
          # renovate: datasource=repology depName=centos_stream_9/sysstat
          - sysstat-12.5.4-9.el9
          # renovate: datasource=repology depName=centos_stream_9/git
          - git-2.47.3-1.el9_6
          # renovate: datasource=repology depName=centos_stream_9/nfs-utils
          - nfs-utils-1:2.5.4-38.el9
          # renovate: datasource=repology depName=centos_stream_9/wget
          - wget-1.21.1-8.el9_4
          # renovate: datasource=repology depName=centos_stream_9/ca-certificates
          - ca-certificates-2025.2.80_v9.0.305-91.el9
          # renovate: datasource=repology depName=centos_stream_9/curl
          - curl-7.76.1-34.el9
          # renovate: datasource=repology depName=centos_stream_9/gnupg2
          - gnupg2-2.3.3-4.el9
          # renovate: datasource=repology depName=centos_stream_9/jq
          - jq-1.6-19.el9
          # renovate: datasource=repology depName=centos_stream_9/rsync
          - rsync-3.2.5-3.el9
          # renovate: datasource=repology depName=centos_stream_9/smartmontools
          - smartmontools-7.2-9.el9
          # renovate: datasource=repology depName=centos_stream_9/tree
          - tree-1.8.0-10.el9
          # renovate: datasource=repology depName=centos_stream_9/nvme-cli
          - nvme-cli-2.13-1.el9
          # renovate: datasource=repology depName=centos_stream_9/python-pip
          - python3-pip-21.3.1-1.el9
          # renovate: datasource=repology depName=centos_stream_9/tar
          - tar-1.34-7.el9
          # renovate: datasource=repology depName=centos_stream_9/lvm2
          - lvm2-2.03.32-2.el9
          # renovate: datasource=repology depName=centos_stream_9/bat
          - bat-0.24.0-10.el9

    - name: Install EPEL packages
      ansible.builtin.dnf:
        state: present
        name:
          # renovate: datasource=repology depName=centos_stream_9/htop
          - htop-3.3.0-1.el9

    - name: Download YQ
      ansible.builtin.get_url:
        # renovate: datasource=github-releases depName=mikefarah/yq
        url: https://github.com/mikefarah/yq/releases/download/v4.44.2/yq_linux_arm64
        dest: /usr/local/bin/yq
        mode: "0755"

    - name: Install firewalld
      ansible.builtin.dnf:
        name:
          # renovate: datasource=repology depName=centos_stream_9/firewalld
          - firewalld-1.3.4-15.el9_6
        state: present
      notify: Start firewalld

    - name: Install JC
      ansible.builtin.pip:
        name:
          # renovate: datasource=pypi depName=jc
          - jc==1.25.6
        state: present

  handlers:
    - name: Start firewalld
      ansible.builtin.systemd_service:
        name: firewalld
        state: started
        enabled: true
