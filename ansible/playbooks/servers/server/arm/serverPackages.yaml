---
- name: Install server packages on ARM servers
  hosts: servers-arm
  gather_facts: false
  become: true
  user: arthur
  tasks:
    - name: Upgrade all packages
      ansible.builtin.dnf:
        name: "*"
        state: latest # noqa package-latest

    - name: Install EPEL
      ansible.builtin.dnf:
        state: present
        name:
          - epel-release

    - name: Install packages
      ansible.builtin.dnf:
        state: present
        name:
          # renovate: datasource=repology depName=centos_stream_10/sysstat
          - sysstat-12.6.1-1.el10
          # renovate: datasource=repology depName=centos_stream_10/git
          - git-2.39.3-1.el10
          # renovate: datasource=repology depName=centos_stream_10/nfs-utils
          - nfs-utils-2.5.4-18.el10
          # renovate: datasource=repology depName=centos_stream_10/wget
          - wget-1.21.1-7.el10
          # renovate: datasource=repology depName=centos_stream_10/ca-certificates
          - ca-certificates-2023.2.60-90.2.el10
          # renovate: datasource=repology depName=centos_stream_10/curl
          - curl-7.76.1-23.el10
          # renovate: datasource=repology depName=centos_stream_10/gnupg2
          - gnupg2-2.3.3-2.el10
          # renovate: datasource=repology depName=centos_stream_10/jq
          - jq-1.6-13.el10
          # renovate: datasource=repology depName=centos_stream_10/rsync
          - rsync-3.2.3-19.el10
          # renovate: datasource=repology depName=centos_stream_10/smartmontools
          - smartmontools-7.2-6.el10
          # renovate: datasource=repology depName=centos_stream_10/tree
          - tree-1.8.0-10.el10
          # renovate: datasource=repology depName=centos_stream_10/nvme-cli
          - nvme-cli-2.2.1-1.el10
          # renovate: datasource=repology depName=centos_stream_10/python-pip
          - python3-pip-21.2.3-6.el10
          # renovate: datasource=repology depName=centos_stream_10/python-pip
          - pip-21.2.3-6.el10
          # renovate: datasource=repology depName=centos_stream_10/tar
          - tar-1.34-6.el10
          # renovate: datasource=repology depName=centos_stream_10/lvm2
          - lvm2-2.03.17-7.el10
          # renovate: datasource=repology depName=centos_stream_10/bat
          - bat-0.18.3-1.el10

    - name: Install EPEL packages
      ansible.builtin.dnf:
        state: present
        name:
          # renovate: datasource=repology depName=centos_stream_10/htop
          - htop-3.2.1-1.el10

    - name: Download YQ
      ansible.builtin.get_url:
        # renovate: datasource=github-releases depName=mikefarah/yq
        url: https://github.com/mikefarah/yq/releases/download/v4.44.2/yq_linux_arm64
        dest: /usr/local/bin/yq
        mode: "0755"

    - name: Install firewalld
      ansible.builtin.dnf:
        name:
          # renovate: datasource=repology depName=centos_stream_10/firewalld
          - firewalld-1.2.5-2.el10
        state: present
      notify: Start firewalld

    - name: Install JC
      ansible.builtin.pip:
        name:
          # renovate: datasource=pypi depName=jc
          - jc==1.25.2
        state: present

  handlers:
    - name: Start firewalld
      ansible.builtin.systemd_service:
        name: firewalld
        state: started
        enabled: true
