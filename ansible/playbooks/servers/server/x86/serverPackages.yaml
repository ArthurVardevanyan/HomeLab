---
- name: Install server packages on x86 servers
  hosts: servers-x86
  gather_facts: false
  become: true
  user: arthur
  tasks:
    - name: Upgrade all packages
      ansible.builtin.dnf:
        name: "*"
        state: latest # noqa package-latest
    - name: Install packages
      ansible.builtin.dnf:
        state: present
        name:
          # - ntp
          # - htop
          # renovate: datasource=repology depName=centos_stream_9/sysstat
          - sysstat #12.5.4-9.el9
          # renovate: datasource=repology depName=centos_stream_9/git
          - git #-2.47.3-1.el9_6
          # renovate: datasource=repology depName=centos_stream_9/nfs-utils
          - nfs-utils #1:2.5.4-38.el9
          # - speedtest-cli
          # renovate: datasource=repology depName=centos_stream_9/wget
          - wget #1.21.1-8.el9_4
          # - apt-transport-https
          # renovate: datasource=repology depName=centos_stream_9/ca-certificates
          - ca-certificates #2025.2.80_v9.0.305-91.el9
          # renovate: datasource=repology depName=centos_stream_9/curl
          - curl #7.76.1-34.el9
          # renovate: datasource=repology depName=centos_stream_9/gnupg2
          - gnupg2 #2.3.3-4.el9
          # - software-properties-common
          # - pv
          # renovate: datasource=repology depName=centos_stream_9/jq
          - jq #1.6-19.el9
          # renovate: datasource=repology depName=centos_stream_9/rsync
          - rsync #3.2.5-3.el9
          # - open-iscsi
          # - nfs-common
          # renovate: datasource=repology depName=centos_stream_9/smartmontools
          - smartmontools #7.2-9.el9
          # renovate: datasource=repology depName=centos_stream_9/tree-pkg
          - tree #1.8.0-10.el9
          # renovate: datasource=repology depName=centos_stream_9/nvme-cli
          - nvme-cli #2.13-1.el9
          # renovate: datasource=repology depName=epel_9/rust-bat
          - bat #0.24.0-10.el9
          # renovate: datasource=repology depName=centos_stream_9/python-pip
          - python3-pip #21.3.1-1.el9
    - name: Enable codeready-builder repositories
      community.general.rhsm_repository:
        name: codeready-builder-for-rhel-10-x86_64-rpms
        state: enabled
    # https://www.redhat.com/sysadmin/install-epel-linux
    # https://unix.stackexchange.com/questions/560024/ansible-right-way-to-enable-epel-yum-repository-vs-yum
    - name: Install package epel-release
      ansible.builtin.dnf:
        name: epel-release
        state: present

    - name: Install epel packages
      ansible.builtin.dnf:
        state: present
        name:
          # renovate: datasource=repology depName=epel_9/htop
          - htop #-3.3.0-1.el9
          # renovate: datasource=repology depName=epel_9/moreutils
          - moreutils #-0.66-1.el9
    - name: Download YQ
      ansible.builtin.get_url:
        # renovate: custom-github-release depName=mikefarah/yq
        url: https://github.com/mikefarah/yq/releases/download/v4.50.1/yq_linux_amd64
        dest: /usr/local/bin/yq
        mode: "0755"
    - name: Install JC
      ansible.builtin.pip:
        name:
          # renovate: datasource=pypi depName=jc
          - jc==1.25.2
        state: present
