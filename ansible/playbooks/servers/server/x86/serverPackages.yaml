---
- name: Install server packages on x86 servers
  hosts: servers-x86
  gather_facts: false
  become: true
  user: arthur
  tasks:
    - name: Upgrade all packages
      ansible.builtin.dnf:
        name: "*"
        state: latest # noqa package-latest
    - name: Install packages
      ansible.builtin.dnf:
        state: present
        name:
          # - ntp
          # - htop
          # renovate: datasource=repology depName=centos_stream_10/sysstat
          - sysstat-12.6.1-1.el10
          # renovate: datasource=repology depName=centos_stream_10/git
          - git-2.39.3-1.el10
          # renovate: datasource=repology depName=centos_stream_10/nfs-utils
          - nfs-utils-2.5.4-18.el10
          # - speedtest-cli
          # renovate: datasource=repology depName=centos_stream_10/wget
          - wget-1.21.1-7.el10
          # - apt-transport-https
          # renovate: datasource=repology depName=centos_stream_10/ca-certificates
          - ca-certificates-2023.2.60-90.2.el10
          # renovate: datasource=repology depName=centos_stream_10/curl
          - curl-7.76.1-23.el10
          # renovate: datasource=repology depName=centos_stream_10/gnupg2
          - gnupg2-2.3.3-2.el10
          # - software-properties-common
          # - pv
          # renovate: datasource=repology depName=centos_stream_10/jq
          - jq-1.6-13.el10
          # renovate: datasource=repology depName=centos_stream_10/rsync
          - rsync-3.2.3-19.el10
          # - open-iscsi
          # - nfs-common
          # renovate: datasource=repology depName=centos_stream_10/smartmontools
          - smartmontools-7.2-6.el10
          # renovate: datasource=repology depName=centos_stream_10/tree
          - tree-1.8.0-10.el10
          # renovate: datasource=repology depName=centos_stream_10/nvme-cli
          - nvme-cli-2.2.1-1.el10
          # renovate: datasource=repology depName=centos_stream_10/bat
          - bat-0.18.3-1.el10
          # renovate: datasource=repology depName=centos_stream_10/python-pip
          - python3-pip-21.2.3-6.el10
    - name: Enable codeready-builder repositories
      community.general.rhsm_repository:
        name: codeready-builder-for-rhel-10-x86_64-rpms
        state: enabled
    # https://www.redhat.com/sysadmin/install-epel-linux
    # https://unix.stackexchange.com/questions/560024/ansible-right-way-to-enable-epel-yum-repository-vs-yum
    - name: Install package epel-release
      ansible.builtin.dnf:
        name: epel-release
        state: present

    - name: Install epel packages
      ansible.builtin.dnf:
        state: present
        name:
          # renovate: datasource=repology depName=centos_stream_10/htop
          - htop-3.2.1-1.el10
          # renovate: datasource=repology depName=centos_stream_10/moreutils
          - moreutils-0.66-1.el10
    - name: Download YQ
      ansible.builtin.get_url:
        # renovate: datasource=github-releases depName=mikefarah/yq
        url: https://github.com/mikefarah/yq/releases/download/v4.44.2/yq_linux_amd64
        dest: /usr/local/bin/yq
        mode: "0755"
    - name: Install JC
      ansible.builtin.pip:
        name:
          # renovate: datasource=pypi depName=jc
          - jc==1.25.2
        state: present
